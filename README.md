# 📅 사회복무요원 근무표 자동 생성기

OR-Tools CP-SAT 기반의 모바일 친화적인 근무표 자동 생성 웹 애플리케이션입니다.

## ✨ 주요 기능

### 🎯 핵심 기능
- **동적 달력 처리**: 사용자가 선택한 연월의 정확한 일수와 요일을 자동 계산
- **최적화 엔진**: Google OR-Tools CP-SAT 솔버를 사용한 제약 조건 만족 문제 해결
- **모바일 반응형 디자인**: 스마트폰, 태블릿, 데스크탑 모든 환경에서 최적화된 UI/UX
- **고정 근무 지정**: 특정 인원의 특정 날짜 근무를 미리 지정 가능
- **CSV 다운로드**: 생성된 근무표를 CSV 파일로 다운로드

### 📊 근무 유형
- **DAY (주간)**: 일반 주간 근무
- **NIGHT (야간)**: 야간 근무
- **OFF_B (비번)**: 야간 근무 다음 날 익일 휴무
- **OFF_R (휴무)**: 순수 휴일

## 🛡️ 제약 조건

### 필수 제약 조건 (Hard Constraints)

1. **근무일수 고정**
   - 실질 근무일수 (DAY + NIGHT + OFF_B) = 20일 (설정 가능)
   - 순수 휴일 (OFF_R) = 총 일수 - 근무일수

2. **야간-비번 연동**
   - NIGHT 근무 다음 날은 반드시 OFF_B
   - OFF_B는 전날 NIGHT가 있었을 때만 가능 (양방향 제약)

3. **최대 연속 근무**
   - OFF_B나 OFF_R 없이 7일 이상 연속 근무 금지
   - 실질 근무 6일 후 최소 1일 휴무 필수

4. **최소 인원 필수**
   - 모든 날짜에 주간(DAY) 최소 1명
   - 모든 날짜에 야간(NIGHT) 최소 1명

5. **특수 규칙**
   - 인원 명단의 맨 밑 두 명은 같은 날 같은 유형의 근무 불가
   - 근무 형평성을 위한 제약

6. **고정 근무**
   - 사용자가 지정한 특정 인원/날짜/근무는 반드시 준수

### 최적화 목표 (Soft Constraints)

1. **연속 근무 최소화**: 5일 이상 연속 실질 근무 횟수 최소화
2. **휴무 권장**: OFF_B 다음 날 OFF_R이 되도록 권장
3. **근무 균등 분배**: 모든 인원의 DAY/NIGHT 횟수 균등 분배

## 🚀 설치 및 실행

### 1. 시스템 요구사항
- Python 3.8 이상
- pip 패키지 관리자

### 2. 설치

```bash
# 저장소 클론 또는 다운로드
cd work_schedule_generator

# 가상 환경 생성 (권장)
python -m venv venv

# 가상 환경 활성화
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# 필요한 패키지 설치
pip install -r requirements.txt
```

### 3. 실행

```bash
# Flask 서버 실행
python app.py
```

서버가 시작되면 브라우저에서 다음 주소로 접속:
```
http://localhost:5000
```

## 📱 사용 방법

### 1. 기본 설정
1. **연도/월 선택**: 근무표를 생성할 연월을 선택
2. **달력 정보 확인**: "달력 정보 새로고침" 버튼으로 해당 월의 정보 확인
3. **근무일수 설정**: 실질 근무일수 입력 (기본값: 20일)

### 2. 인원 설정
1. 기본 2명의 인원 입력 필드 제공
2. "인원 추가" 버튼으로 추가 인원 입력
3. 각 인원의 이름 입력 (최소 2명 필수)

### 3. 고정 근무 지정 (선택사항)
1. "고정 근무 추가" 버튼 클릭
2. 직원, 날짜, 근무 유형 선택
3. "추가" 버튼으로 고정 근무 지정
4. 여러 개의 고정 근무 지정 가능

### 4. 근무표 생성
1. "근무표 생성" 버튼 클릭
2. 솔버가 최적의 근무표를 생성 (최대 2분 소요)
3. 결과 확인

### 5. 결과 활용
- 생성된 근무표를 웹에서 확인
- 각 날짜별 근무 인원 통계 확인
- "근무표 다운로드 (CSV)" 버튼으로 파일 저장
- "새로 만들기" 버튼으로 새 근무표 생성

## ⚠️ 오류 처리

### 해답을 찾지 못한 경우
다음과 같은 경고 메시지가 표시됩니다:

```
⚠️ 경고: 설정된 제약 조건이 너무 강력하여 모든 필수 조건을 만족하는
근무표를 생성할 수 없습니다. 최소한의 필수 조건을 제외한 일부
제약 조건(예: 4일 초과 근무 피하기, 휴무 균등 분포 등)을
완화하거나 인원수와 근무-휴일 비율을 조정해야 합니다.
```

**해결 방법:**
1. 인원수를 늘리기
2. 근무일수를 조정 (20일에서 18~19일로 감소)
3. 고정 근무를 줄이거나 제거
4. 인원 수와 근무 설정의 균형 맞추기

## 📁 프로젝트 구조

```
work_schedule_generator/
├── app.py                  # Flask 애플리케이션 메인 파일
├── schedule_solver.py      # OR-Tools 솔버 로직
├── requirements.txt        # Python 패키지 의존성
├── .gitignore             # Git 제외 파일 목록
├── README.md              # 프로젝트 문서 (이 파일)
├── templates/             # HTML 템플릿
│   └── index.html        # 메인 페이지
└── static/               # 정적 파일
    ├── style.css         # 반응형 스타일시트
    └── script.js         # 프론트엔드 JavaScript
```

## 🔧 기술 스택

### 백엔드
- **Flask 3.0**: Python 웹 프레임워크
- **OR-Tools 9.8**: Google 최적화 라이브러리 (CP-SAT 솔버)
- **Python 3.8+**: 프로그래밍 언어

### 프론트엔드
- **HTML5**: 시맨틱 마크업
- **CSS3**: 모바일 우선 반응형 디자인 (Flexbox, Grid)
- **JavaScript (ES6+)**: 동적 UI 및 API 통신

## 📊 알고리즘 상세

### CP-SAT (Constraint Programming - SAT)
OR-Tools의 CP-SAT 솔버는 제약 조건 만족 문제(CSP)를 해결하는 강력한 도구입니다.

#### 의사결정 변수
- `shifts[i, d, s]`: 직원 i가 날짜 d에 근무 유형 s를 하는지 여부 (Boolean)
- 총 변수 개수: `인원 수 × 일수 × 4`

#### 제약 조건 모델링
1. **AllDifferent**: 각 날짜마다 정확히 하나의 근무 유형만 할당
2. **Linear Constraints**: 근무일수 합계 = 20일
3. **Implication**: NIGHT(d) → OFF_B(d+1)
4. **Sliding Window**: 7일 연속 근무 금지
5. **Cardinality**: 각 날짜 최소 인원 필수

#### 목표 함수
가중치 기반 최소화:
```
Minimize: 100×(연속5일근무) - 50×(OFF_B→OFF_R) + 10×(근무불균형)
```

## 🎨 반응형 디자인

### 모바일 우선 (Mobile-First)
- 기본 스타일: 320px ~ 767px (스마트폰)
- 미디어 쿼리로 태블릿/데스크탑 대응

### 브레이크포인트
- **모바일**: < 768px
- **태블릿**: 768px ~ 1023px
- **데스크탑**: ≥ 1024px

### 주요 반응형 요소
- 유동적인 그리드 레이아웃
- 터치 친화적인 버튼 크기 (최소 44×44px)
- 가로 스크롤 가능한 테이블
- 모달 다이얼로그 모바일 최적화

## 🤝 기여하기

버그 리포트, 기능 제안, 풀 리퀘스트를 환영합니다!

## 📄 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 👨‍💻 개발자

Powered by OR-Tools CP-SAT Solver | Made with ❤️ for 사회복무요원

## 📞 문의

문제가 발생하거나 질문이 있으시면 이슈를 등록해주세요.

---

**Happy Scheduling! 🎉**
