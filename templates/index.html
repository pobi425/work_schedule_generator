<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사회복무요원 근무표 자동 생성기</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>📅 사회복무요원 근무표 자동 생성기</h1>
            <p class="subtitle">OR-Tools CP-SAT 기반 최적화 엔진</p>
        </header>

        <main class="main-content">
            <!-- 입력 폼 섹션 -->
            <section class="input-section">
                <h2>📝 근무표 설정</h2>

                <form id="scheduleForm">
                    <!-- 연월 선택 -->
                    <div class="form-group">
                        <label for="year">연도</label>
                        <input type="number" id="year" name="year"
                               min="2000" max="2100"
                               value="{{ current_year }}"
                               required>
                    </div>

                    <div class="form-group">
                        <label for="month">월</label>
                        <select id="month" name="month" required>
                            {% for m in range(1, 13) %}
                            <option value="{{ m }}" {% if m == current_month %}selected{% endif %}>
                                {{ m }}월
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- 달력 정보 표시 -->
                    <div id="calendarInfo" class="info-box" style="display: none;">
                        <h3>📆 달력 정보</h3>
                        <p><strong>총 일수:</strong> <span id="numDays">-</span>일</p>
                        <p><strong>1일 요일:</strong> <span id="firstDay">-</span></p>
                        <p><strong>말일 요일:</strong> <span id="lastDay">-</span></p>
                    </div>

                    <!-- 근무 설정 -->
                    <div class="form-group">
                        <label for="workDays">실질 근무일수</label>
                        <input type="number" id="workDays" name="workDays"
                               min="1" max="31" value="20" required>
                        <small>DAY + NIGHT + OFF_B 합계</small>
                    </div>

                    <!-- 인원 설정 -->
                    <div class="form-group">
                        <label>근무 인원 (최소 2명)</label>
                        <div id="employeesList">
                            <div class="employee-input">
                                <input type="text" class="employee-name" placeholder="이름 1" required>
                                <button type="button" class="btn-remove" onclick="removeEmployee(this)">✕</button>
                            </div>
                            <div class="employee-input">
                                <input type="text" class="employee-name" placeholder="이름 2" required>
                                <button type="button" class="btn-remove" onclick="removeEmployee(this)">✕</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addEmployee()">
                            ➕ 인원 추가
                        </button>
                    </div>

                    <!-- 고정 근무 설정 -->
                    <div class="form-group">
                        <label>고정 근무 지정 (선택사항)</label>
                        <div id="fixedShiftsList">
                            <!-- JavaScript로 동적 생성 -->
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="showFixedShiftModal()">
                            📌 고정 근무 추가
                        </button>
                    </div>

                    <!-- 제출 버튼 -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="loadCalendarInfo()">
                            🔄 달력 정보 새로고침
                        </button>
                        <button type="submit" class="btn btn-success">
                            🚀 근무표 생성
                        </button>
                    </div>
                </form>
            </section>

            <!-- 로딩 표시 -->
            <div id="loadingSpinner" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>근무표를 생성하는 중입니다... (최대 2분 소요)</p>
            </div>

            <!-- 오류 메시지 -->
            <div id="errorMessage" class="alert alert-error" style="display: none;">
                <h3>⚠️ 오류</h3>
                <p id="errorText"></p>
            </div>

            <!-- 결과 섹션 -->
            <section id="resultSection" class="result-section" style="display: none;">
                <h2>✅ 근무표 생성 완료</h2>

                <!-- 상태 정보 -->
                <div class="info-box">
                    <p><strong>솔버 상태:</strong> <span id="solverStatus"></span></p>
                    <p><strong>대상 연월:</strong> <span id="resultYearMonth"></span></p>
                </div>

                <!-- 근무표 테이블 -->
                <div class="table-container">
                    <table id="scheduleTable" class="schedule-table">
                        <!-- JavaScript로 동적 생성 -->
                    </table>
                </div>

                <!-- 범례 -->
                <div class="legend">
                    <h3>범례</h3>
                    <ul>
                        <li><span class="shift-badge shift-day">D</span> 주간 (DAY)</li>
                        <li><span class="shift-badge shift-night">N</span> 야간 (NIGHT)</li>
                        <li><span class="shift-badge shift-offb">B</span> 비번 (OFF_B)</li>
                        <li><span class="shift-badge shift-offr">R</span> 휴무 (OFF_R)</li>
                    </ul>
                </div>

                <!-- 통계 -->
                <div id="statisticsSection" class="statistics">
                    <!-- JavaScript로 동적 생성 -->
                </div>

                <!-- 다운로드 버튼 -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="downloadSchedule()">
                        💾 근무표 다운로드 (CSV)
                    </button>
                    <button type="button" class="btn btn-primary" onclick="resetForm()">
                        🔄 새로 만들기
                    </button>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>Powered by OR-Tools CP-SAT Solver | Made with ❤️ for 사회복무요원</p>
        </footer>
    </div>

    <!-- 고정 근무 추가 모달 -->
    <div id="fixedShiftModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeFixedShiftModal()">&times;</span>
            <h3>고정 근무 추가</h3>

            <div class="form-group">
                <label for="fixedEmployee">직원</label>
                <select id="fixedEmployee" class="form-control">
                    <!-- JavaScript로 동적 생성 -->
                </select>
            </div>

            <div class="form-group">
                <label for="fixedDay">날짜</label>
                <input type="number" id="fixedDay" min="1" max="31" value="1" class="form-control">
            </div>

            <div class="form-group">
                <label for="fixedShiftType">근무 유형</label>
                <select id="fixedShiftType" class="form-control">
                    <option value="0">주간 (DAY)</option>
                    <option value="1">야간 (NIGHT)</option>
                    <option value="2">비번 (OFF_B)</option>
                    <option value="3">휴무 (OFF_R)</option>
                </select>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeFixedShiftModal()">취소</button>
                <button type="button" class="btn btn-primary" onclick="addFixedShift()">추가</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
